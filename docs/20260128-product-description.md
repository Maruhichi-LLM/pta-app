# Knot — 商品説明書

**作成日**: 2026-01-28
**バージョン**: Web Application (Next.js 16.1.3)

---

## Knot とは

**Knot** は、日本の非営利団体・地域組織のために設計された組織運営プラットフォームです。

> Knot is not only for PTA.
> Knot is not only for events.
> Knot is not only for accounting.
> Knot is where everything connects.

PTA、NPO法人、町内会、自治会、サークル——あらゆる非営利団体が抱える「会話が記録に残らない」「会計処理が属人化する」「引き継ぎで情報が途切れる」という課題を、ひとつのプラットフォームで解決します。

---

## 5つの設計思想

| # | 思想 | 内容 |
|---|------|------|
| 1 | **意思決定の透明化** | チャットを起点に、すべての成果物（タスク、会計、文書）へ紐付け。意思決定の経緯を追跡可能にする |
| 2 | **会計の信頼性** | 多段階承認、年度締め、予算管理を標準搭載。団体の信頼性を担保する |
| 3 | **モジュラー設計** | 必要な機能だけを有効化し、最小構成から段階的に拡張できる |
| 4 | **日本の非営利運営に最適化** | 会計年度、役割慣行、日本語UIを前提に現場の負荷を下げる |
| 5 | **トレーサビリティと監査性** | 監査ログ、内部統制チェック、履歴保存でガバナンスを標準化する |

---

## 対象ユーザー

| セグメント | 団体数（推定） | 典型的な課題 |
|-----------|--------------|------------|
| NPO法人 | 約 51,000 | 助成金報告、多段階承認、監査対応 |
| 町内会・自治会 | 約 290,000 | 会費管理、行事運営、年度引き継ぎ |
| PTA・保護者会 | 約 40,000 | 役員交代、会計の属人化、連絡手段の分散 |
| サークル・同好会 | 約 50,000 | イベント出欠、会費徴収、情報共有 |

---

## モジュール一覧

Knot は **14 のモジュール + 1 つの拡張機能** で構成されています。
団体は Knot Store から必要なモジュールだけを有効化して使えます。

---

### コアモジュール

#### Knot Chat — 意思決定ハブ
`意思決定 / ハブ`

発言そのものを次の行動へつなげる意思決定ハブ。チャットから ToDo・会計・議事録へ直接変換します。

- **フリースレッド**: 自由なテーマで議論を開始
- **連携スレッド**: ToDo、イベント、会計、文書、投票と自動紐付け
- **メッセージ変換**: チャットの発言をワンクリックで ToDo 化・経費登録・文書化
- **ステータス管理**: スレッドの Open / Close で議論の状態を管理
- **追跡性**: すべてのメッセージに起点情報（sourceThreadId / sourceChatMessageId）を保持

---

#### Knot Voting — 合意形成
`合意形成 / Voting`

匿名投票で団体の意思を集め、結果と意見をチャットに還元します。

- **匿名投票**: SHA256ハッシュによる匿名性保証（投票者の特定不可）
- **選択肢**: 2〜10 の選択肢を自由に設定
- **締切管理**: 投票期限を設定し、期限後に自動クローズ
- **コメント機能**: 投票と合わせて意見を添えられる
- **変換**: 投票結果を ToDo やチャットスレッドに変換可能
- **集計表示**: リアルタイムの投票状況と結果を可視化

---

#### Knot ToDo — タスク管理
`実行 / Action`

会話から生まれたタスクを簡潔に管理。誰が・いつまでに・何をやるかを素早く共有します。

- **チャット連携**: メッセージから直接タスク化
- **ステータス管理**: TODO → 進行中 → 完了の 3 ステート
- **担当者アサイン**: メンバーへの直接割り当て
- **期限設定**: 期限による管理
- **起点追跡**: どのチャットから生まれたタスクかを常に参照可能

---

#### Knot Event — イベント管理
`イベント / Planning`

行事の登録とメンバーの出欠を一つに。

- **イベント作成**: タイトル、日時、場所、説明を登録
- **出欠管理**: 参加 / 不参加 / 未定の 3 種回答 + コメント
- **出欠集計**: 一覧表示で参加状況を即座に把握
- **CSV / PDF エクスポート**: 出欠表をワンクリックで出力
- **チャット連携**: イベントに紐付いたスレッドで詳細を議論

---

#### Knot Calendar — カレンダー
`共有ビュー / Calendar`

行事を月間ビューで共有。

- **月次カレンダー**: 団体イベントと個人予定を統合表示
- **月間ナビゲーション**: 前月・次月への移動
- **イベント作成**: カレンダーのセルから直接イベントを追加
- **色分け**: 団体イベントと個人予定を視覚的に区別

---

#### Knot Accounting — 会計
`会計 / Finance`

経費精算と承認フローをシンプルに。Knot の中核モジュール。

- **経費・収入記録**: 金額、日付、勘定科目、証憑を登録
- **多段階承認ワークフロー**: 1〜3 段階のカスタマイズ可能な承認フロー
  - 承認 / 却下アクション
  - 承認コメント
  - 承認者の記録
- **勘定科目管理**: 資産、負債、収入、支出の 4 分類 + カスタム科目
- **予算管理**: 年度別予算の設定と実績比較
- **会計年度**: 開始月を自由に設定（例: 4月〜翌3月）
- **年度締め処理**:
  - 収支計算書の自動生成
  - 前期繰越金の自動計算
  - 年度確定（不可逆）と次年度への自動遷移
- **証憑管理**: ファイルアップロードと URL 保存
- **赤伝票対応**: マイナス金額による修正仕訳

---

#### Knot Document — 文書管理
`ドキュメント / Archive`

団体の確定版ドキュメントを保管し、年度引き継ぎをシンプルにするモジュールです。

- **文書アップロード**: ファイルとメタデータを登録
- **バージョン管理**: 同一文書の版を追跡
- **カテゴリ分類**: 規約 / 報告書 / 財務 / 議事録 / その他
- **年度紐付け**: 会計年度との関連付け
- **チャット連携**: 会話から直接文書を作成

---

#### Knot Records — 活動記録
`写真 / Evidence`

写真による活動記録。

- **写真アップロード**: 活動の様子を画像で記録
- **メタデータ**: 日付、キャプションを添付
- **イベント紐付け**: どのイベントの記録かを関連付け
- **ギャラリー表示**: 写真をまとめて閲覧

---

#### Knot Export — エクスポート
`エクスポート / Export`

イベント出欠表や収支計算書など、各モジュールのデータを CSV・PDF で出力できます。

- **イベント出欠 CSV / PDF**: 出席者リストを出力
- **収支計算書**: 年度別の財務レポートを出力
- **一括ダウンロード**: 必要なデータをまとめて取得

---

### ガバナンス系モジュール

#### Knot Workflow — 承認フロー
`承認 / Workflow`

備品購入や休暇申請など、団体のあらゆる申請フローを多段階承認で管理します。

- **承認ルート設計**: 複数ステップの承認経路を定義
- **ロールベース承認**: 管理者 / 会計係 / 監査役による段階承認
- **条件分岐**: 金額やロールに応じた承認ルートの分岐
- **テンプレート**: JSON スキーマによる申請フォームの定義
- **ステータス追跡**: 下書き → 申請中 → 承認済 / 却下

---

#### Knot Audit — 監査
`監査 / Governance`

会計・活動の監査を計画し、指摘事項や改善提案を記録できるガバナンスモジュールです。

- **監査ログ**: 全操作の自動記録（作成 / 更新 / 削除 / 承認 / 却下）
- **内部統制チェック**: 4 つの自動検知ルール
  - **職務分掌**: 作成者と承認者が同一でないかチェック
  - **高額承認**: 一定額以上の承認に必要な承認数を検証
  - **無承認確認**: 承認ゼロで確定された項目を検出
  - **出所リンク欠落**: チャット紐付けのない帳簿を検出
- **指摘事項管理**: 発見 → 対応中 → 解決済のワークフロー
- **アクセス制御**: 管理者 / 会計係 / 監査役のみ閲覧可

---

#### Knot Insight — ダッシュボード
`気づき / Insight`

団体運営の状態をやわらかく可視化し、気づきにつながるヒントを届けます。

- **活動指標**: メッセージ数、タスク完了率、イベント参加率
- **財務指標**: 収支バランス、予算消化率
- **ガバナンス指標**: 承認状況、監査指摘の対応状況

---

### システムモジュール（常時有効）

#### Knot Management — 組織設定
`組織設定 / Governance`

招待や機能 ON/OFF、収支内訳書・予算設定を管理するヒューマンモジュール。

- **メンバー招待**: 期限付き招待コードの発行
- **役割管理**: 4 つのロール
  - **管理者 (ADMIN)**: 全権限
  - **会計係 (ACCOUNTANT)**: 会計承認権限
  - **監査役 (AUDITOR)**: 監査閲覧権限
  - **メンバー (MEMBER)**: 基本操作権限
- **団体設定**: 名称、会計年度開始月の設定

---

#### Knot Store — モジュール管理
`モジュール管理 / App Store`

団体向けモジュールの追加・有効化・無効化をまとめて管理するモジュールストア（管理者専用）。

- **モジュール一覧**: 全モジュールの概要と状態を表示
- **有効化 / 無効化**: ワンクリックでモジュールの ON / OFF を切り替え
- **管理者専用**: 管理者ロールのみ操作可

---

### 拡張機能

#### Knot Event Budget Extension — イベント予算
`Event / Extension`

イベントごとの収入・支出を個別に管理し、本会計に取り込む拡張機能です。

- **イベント別予算**: 予算（収入・支出）の計画値を設定
- **取引記録**: イベントごとの収入・支出を個別に記録
- **予実比較**: 計画と実績の差異を可視化
- **本会計インポート**: 確定した収支をメインの帳簿へワンクリックで取り込み
- **ステータス管理**: 計画中 → 進行中 → 確定 → インポート済

---

## 横断機能

モジュールをまたいで利用できる共通機能です。

### グローバル検索（Cmd+K / Ctrl+K）
すべてのモジュールのデータを横断検索。チャットメッセージ、スレッド、タスク、イベント、帳簿、文書を一括で検索できます。

### チャット変換
チャットのメッセージからワンクリックで以下を作成：
- ToDo（タスク化）
- 帳簿（経費登録）
- 文書（議事録化）
- イベント予算取引

### トレーサビリティ
すべてのエンティティに「どのチャットから生まれたか」の情報を保持。意思決定の起点を常に追跡可能。

### 監査ログ
全操作を自動記録。操作者、操作内容、変更前後のデータを保存。

---

## 技術仕様

| 項目 | 仕様 |
|------|------|
| フレームワーク | Next.js 16.1.3 (App Router) + React 19 |
| 言語 | TypeScript 5 (strict mode) |
| データベース | PostgreSQL 15 |
| ORM | Prisma 5.21.1 (25+ モデル) |
| スタイリング | Tailwind CSS 4 |
| 認証 | セッションベース (HMAC-SHA256 / bcryptjs) |
| PDF生成 | pdf-lib + fontkit |
| セキュリティ | CSRF 対策 / レート制限 / Origin 検証 |
| コンテナ | Docker Compose |

---

## 料金プラン（想定）

| プラン | 月額 | メンバー数 | モジュール | サポート |
|--------|------|-----------|-----------|---------|
| Free | ¥0 | 最大 10 名 | Chat, ToDo | コミュニティ |
| Standard | ¥3,000 | 最大 30 名 | 全コア機能 | メール |
| Premium | ¥8,000 | 無制限 | 全機能 + 拡張 | 優先 + 電話 |
| Enterprise | ¥50,000 | 無制限 | 全機能 + カスタム | 専任対応 |

---

## Knot が選ばれる理由

1. **会計機能の圧倒的な深さ** — 年度締め・多段階承認・予算管理まで一体化。NPO法人会計基準を意識した設計
2. **チャットから始まるすべて** — 会話を ToDo・会計・文書に直接変換。情報の分断を防止
3. **必要な分だけ使える** — モジュラー設計で最小構成からスタート可能
4. **監査に耐えるガバナンス** — 内部統制チェック・監査ログ・職務分掌を標準装備
5. **日本の団体運営を知っている** — 会計年度・役職・日本語UIを前提とした設計
